{% comment %}
    Inspect object template for the 'interactive' style of inspect for inventree-part-template plugin  

    Copyright (c) 2024 Chris Midgley
    License: MIT (see LICENSE file)

    This template is used to render details of an inspected object (such as when using the explore
    filter).  It should render the information desired for the object, and then recurse on the
    children for a heirarcy of the object details.

    The following context variables are available:
    - object: the object to render
    - object_template: the name of the child template to load for rendering the object and it's
    children.  Only include the template if there are children to render.

    Properties of object are:
    - title: the title of the object, usually it's name or important identifier
    - id: the id (anchor) of the object, used by `link_anchor` to reference this object
    - type: the type of the object, like a 'str', 'int', or a class name
    - prefix: the prefix to use before the children or value such as "{" for classes or "[" for
    lists, or "(" for methods.
    - link_to: if the item has been skipped due to recursion, this is the id (anchor) of the object
    that did render
    - value: the value of the object, when it is a simple value (only when no children)
    - postfix: the postfix to use after the children, such as "}" for classes or "]" for lists, or
    ")" for methods.
    - children: the object to pass the template using recursion (see above).  Will be None when
    the object is not allowed to have children, or 0 when it could but has none.
    - total_children: the total number of children in the children object, which can be a number
    larger than the number of items in children due to filtering of item-level content
{% endcomment %}

{% load report part_templates %}
<div class="inspect-interactive-item">
    {% if object.link_to %}
    <div class="inspect-interactive-item-title">
        <button class="btn">
            <span class="inspect-interactive-item-title-title inspect-interactive-item-link">
                <a href="#{{ object.link_to }}">{{ object.title }}</a>
            </span>
            ({{object.type}})
        </button>
    </div>
    {% else %}
    <div class="inspect-interactive-item-title">
        {% if object.children|length > 0 %}
        <button class="btn collapsed" data-bs-toggle="collapse" data-bs-target="#children-{{ object.id }}">
            <span class="fas fa-caret-right expando-icon"></span>
        {% else %}
        <button class="btn">
        {% endif %}
            <span id="{{ object.id }}">
                {% if object.value %}
                    <span class="inspect-interactive-item-title-title">{{ object.title }}</span>{{ object.prefix }}{{ object.value }}{{object.postfix}} ({{ object.type }})
                {% else %}
                    <span class="inspect-interactive-item-title-title">{{ object.title }}</span> ({{ object.type }}){% if object.children is not None %}:{% endif %}
                {% endif %}
            </span>
            {% if object.children is not None %}
                {% if object.children|length > 0 %}
                    {{ object.prefix }} 
                    <span class="inspect-interactive-item-title-postfix">
                        {{ object.postfix }}
                    </span>
                {% elif object.total_children > 0 %}
                    {{ object.prefix }} {{object.total_children}} more... {{ object.postfix }}
                {% else %}
                    {{ object.prefix }} &lt;empty&gt; {{ object.postfix }}
                {% endif %}
            {% endif %}
        </button>
    </div>
    {% endif %}
    {% if object.children is not None and object.children|length > 0 %}
    <div id="children-{{ object.id }}" class="collapse">
        <div class="inspect-interactive-item-children">
            {% for child in object.children %}
                {% include object_template with object=child %}
            {% endfor %}
            {% if object.total_children > object.children|length %}
            <div class="inspect-interactive-item inspect-interactive-item-more">
                <div class="inspect-interactive-item-title">
                    <span class="inspect-interactive-item-title-title">
                        {% subtract object.total_children object.children|length %} more...
                    </span>
                </div>
            </div>
            {% endif %}
        </div>
        {{ object.postfix }}
    </div>
    {% endif %}
</div>
